
<div class="jumbotron">
  <h1>Roborent</h1>
  <p>We connect landlords and tenants without agents!</p>
  <!-- <div class="input-group">
      <input type="text" class="form-control" placeholder="Search listings by address">
      <span class="input-group-btn">
        <button class="btn btn-default" type="button">Search</button>
      </span>
    </div> -->
    <div id='suggestions'>
    <%= form_tag(properties_path, :method => "get", id: "search-form") do %>
    <%= text_field_tag :search, params[:search], placeholder: "Enter address or property type", :class => "typeahead" %>
    <%= submit_tag "Search", :name => nil, :class => "btn btn-default" %>
  </div>
<% end %>
</div>

<h3>Popular Properties</h3>
<% @top_shortlists.each do |prop| %>
<div class="col-md-4">
<div class="panel panel-danger">
  <div class="panel-heading">
    <h3 class="panel-title"><%=prop.address%></h3>
  </div>
  <div class="panel-body">
    <div class='container'><%= cl_image_tag(prop.photo_url, :width => 200, :height => 150) %></div>
    <br><br>
    <p>Popularity count: <%=prop.shortlists.count%></p>
    <p>Rental: $<%=prop.price%>/mth for <%=prop.rent_area%></p>
    <%= link_to 'View Details', property_path(prop) %>
  </div>
</div>
</div>
<%end%>

<h3>Recent Properties</h3>

  <% @recent_properties.each do |property| %>
  <div class="col-md-4">
  <div class="panel panel-info">
    <div class="panel-heading">
      <h3 class="panel-title"><%=property.address%></h3>
    </div>
    <div class="panel-body">
      <div class='container'><%= cl_image_tag(property.photo_url, :width => 200, :height => 150) %></div>
      <br><br>
      <p>Rental: $<%=property.price%>/mth for <%=property.rent_area%></p>
      <%= link_to 'View Details', property_path(property) %>
    </div>
  </div>
</div>
  <%end%>


<script>
var substringMatcher = function(strs) {
  return function findMatches(q, cb) {
    var matches, substringRegex;
    // an array that will be populated with substring matches
    matches = [];

    // regex used to determine if a string contains the substring `q`
    substrRegex = new RegExp(q, 'i');

    // iterate through the pool of strings and for any string that
    // contains the substring `q`, add it to the `matches` array
    $.each(strs, function(i, str) {
      if (substrRegex.test(str)) {
        matches.push(str);
      }
    });

    cb(matches);
  };
};

$('#suggestions .typeahead').typeahead({
  hint: true,
  highlight: true,
  minLength: 1
},
{
  name: 'all_properties',
  source: substringMatcher(<%=@all_properties.to_json.html_safe%>)
});

</script>
